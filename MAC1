MAC地址管理是二层管理的一项基本功能，包括：
表1-1 MAC地址管理功能表
MAC地址管理功能项	定义	备注
设置MAC地址老化时间	成功配置MAC地址老化时间后，系统定时检查老化的动态MAC地址，如果在老化时间的1-2倍时长范围内，没有发送或接收任何携带该源MAC地址的报文，对应的MAC地址就会从MAC地址表中删除。	MAC地址表：MAC地址表存在于系统缓存中，其表项包含了与系统相连的设备的MAC地址、所属的VLAN ID以及接口号。在转发数据时，根据数据帧中的目的MAC地址和VLAN ID查询MAC地址表，系统可以快速定位出接口，从而减少广播。
MAC地址可以静态配置，也可以通过系统动态学习记录到MAC地址表中。
限制动态MAC地址学习数	用户端口或业务的动态MAC地址学习数支持手工设置。当系统学习到的MAC地址达到配置的最大动态MAC地址学习数后，用户端口或业务流不再学习新MAC地址。	动态MAC地址可以被老化，即系统在一定时间内没有发送或接收到某设备发送的报文，就会把该设备相关的MAC地址表项删除。
设置静态MAC地址	需要在端口接入某指定MAC地址的设备时，在端口上配置VLAN+静态MAC地址或者为业务流配置静态MAC地址。系统直接根据静态MAC进行数据转发。	-

受益
运营商受益
	老化动态MAC地址可以及时更新MAC地址表，避免系统学习不到新的MAC地址而造成用户数据无法转发。
	限制动态MAC地址学习数可以限制进入网络的MAC地址数量，减少网络设备的负担。
	设置静态MAC地址可以防止仿冒身份的非法用户骗取数据。
 
	如果黑客用户将攻击报文的源MAC地址伪装成合法用户的MAC地址，并从设备的其它接口进入，设备就会学习到错误的MAC地址表项，于是将本应转发给合法用户的报文转发给黑客用户。为了提高接口安全性，网络管理员可手工在MAC地址表中加入特定MAC地址表项，将用户设备与接口绑定，从而防止仿冒身份的非法用户骗取数据。手工配置的MAC地址表项优先级高于自动生成的表项。
	但是静态MAC地址不会随网络设备变化自动更新，需要手工更改。大量使用会增加网络维护的成本。
用户受益
提高用户的安全性：设置业务端口的静态MAC地址后，如果同时设置动态MAC最大学习数为0，则端口只接收该静态MAC的用户数据，实现MAC地址绑定功能来提升用户的安全性。
1.1.2 MAC地址管理过程
MAC地址管理功能从过程上可以分为：MAC地址表的建立和管理。
MAC地址表的建立
建立MAC地址表的两种方式：
	MAC地址学习
−	OLT作为二层交换设备时，MAC地址的学习是分布式学习方式，每个单板都学习从本板出去报文中的源MAC地址，并根据报文的目的MAC地址进行转发，学习到的MAC地址依次存储到系统缓存中。一般来说，系统缓存都是有限的，一旦系统缓存被填满，那么新的MAC地址将无法被学习到。
−	主要配置命令：mac-address learning
 
MAC地址的学习功能只针对单播MAC地址，不学习组播和广播MAC地址。
	静态配置MAC表项
−	网络管理员可手工配置静态MAC表项，将用户设备的MAC地址与端口绑定，可以使携带该MAC地址的报文永久的往某一端口转发，提高转发效率，同时还能提高接口的安全性，防止假冒身份的非法用户接入。这个功能经常被用在某些专网中。
 
包含在不同VLAN中的同一个上行端口可以配置相同的静态MAC地址。
−	主要配置命令：mac-address static
由此建立起来的MAC地址表简化后的样式如下表所示。它体现了用户MAC地址和端口、VLAN ID之间的对应关系。
表1-2 简化MAC地址表
VLAN ID	MAC地址	端口号	MAC属性	转发属性
2	00e0-fc00-0011	0/1/1	dynamic	Forward
3	00e0-fc00-0033	0/1/2	static	Forbid

MAC地址表的管理
MAC地址表的管理可以理解为在考虑系统资源，网络安全隐患等情况下，通过配置一些属性来让MAC地址表更符合实际情况。主要包括以下几个方面。
	基于业务流设置MAC地址最大学习数
−	当接入的用户数量达到限制值后，新接入的用户MAC地址将不被学习。它可以应用于接入用户固定，但又不够安全的网络环境，如小区接入网或缺乏安全管理的企业内部网。
 
	业务流的最大MAC地址学习数，不影响手工添加的静态MAC地址个数。
	设置用户端口的静态MAC地址后，如果同时设置动态MAC最大学习数为0，则端口只接收已配置的静态MAC的用户数据，实现MAC地址绑定功能。此功能可以提高用户安全性。
−	当一条业务流加入service port bundle后，会以该service port bundle的最大MAC地址学习数作为自己的最大MAC地址学习数。整个service port bundle的最大MAC地址学习数以及该service port bundle内的每一条业务流的最大MAC地址数是相等的。当service port bundle内任何一条业务流的最大MAC地址学习数改变时，整个Bundle的最大MAC地址学习数以及该Bundle内的每一条业务流的最大MAC地址数也会一起改变。但是同一个Bundle内所有业务流学习到的MAC地址数总和不能超过该Bundle的最大MAC地址数。
−	主要配置命令：mac-address max-mac-count
	设置系统MAC地址超限感知功能
当系统学习到的MAC地址数量较多时，如果此时出现业务故障，会给故障定位带来一定的困难。MAC地址感知超限功能使能后，系统会每隔15分钟查询MAC地址使用情况，并根据查询结果来决定是否上报告警：首次超过用户设置的MAC地址超限感知上限则上报超限告警，当发生超限告警后，首次低于用户MAC地址超限感知下限则上报故障恢复告警。
主要配置命令：overload-aware mac-address
	MAC地址的老化
一般情况下，MAC地址表是设备通过源MAC地址学习过程而自动建立的。为适应网络的变化，MAC地址表需要不断更新。当网络拓扑改变后，动态MAC地址表项不会及时自动更新。这样系统就学习不到新的MAC地址，从而导致用户数据不能正常转发。因此，需要配置动态MAC地址的老化时间来解决这个问题。
 
系统也支持设置MAC地址不老化，如果没有上述问题，可以不需要使用MAC地址老化功能。
MAC地址的老化功能分为如下几个部分。
项目	描述	主要配置命令
设置MAC地址老化时间	成功设置MAC地址老化时间后，系统定时检查动态MAC地址，如果在老化时间的1-2倍时长范围内，没有发送/接收任何携带该源MAC地址的报文，对应的MAC地址就会从MAC地址表中删除。系统重新进行MAC地址学习，构建新的MAC地址表。	mac-address timer
设置MAC地址老化模式	成功设置MAC地址老化模式后，主控板、业务板都将按照此老化模式老化MAC地址。
	双向老化模式：当采用双向老化方式时，MAC地址表项除了依赖源MAC地址学习刷新外，还依赖于系统有没有收到发送给该目的MAC地址的报文来刷新。当超过老化周期，系统没有再次学习到某源MAC地址、并且也没有收到发送给该目的MAC地址的报文时，将MAC地址表项老化。双向老化模式减少了MAC地址老化及重新学习MAC地址对CPU资源的占用。
	单向老化模式：当采用单向老化方式时，MAC地址表项依赖于源MAC地址学习来刷新，超过老化周期，系统没有再次学习到某源MAC地址时，将该MAC地址表项老化。	mac-address aging-mode

 
	MAC地址HASH冲突：HASH算法是转发芯片为了加速查找转发表项而普遍采用的一种算法。基于VLAN+MAC进行转发模式下，系统在学习MAC地址时，使用某个HASH算法对VLAN+MAC地址进行HASH运算，得到一个HASH漏桶索引（每个漏桶下的MAC地址表项数是固定的，不同主控板可能会有所不同）。如果此时该漏桶下MAC地址表项数已达到最大值，该MAC地址将无法被系统学习，这时称之为产生了MAC地址HASH冲突。
	MAC地址表采用HASH算法，有发生HASH冲突的可能。

