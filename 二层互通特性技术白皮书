
	
	资料编码	
		
 	
	MA5600T 二层互通特性
技术白皮书	 	
			
	文档版本	V2.0
	
	发布日期	2019-11-22
	
	
	
	华为技术有限公司		
		
 
版权所有 © 华为技术有限公司 2009。 保留一切权利。
非经本公司书面许可，任何单位和个人不得擅自摘抄、复制本文档内容的部分或全部，并不得以任何形式传播。

商标声明
 和其他华为商标均为华为技术有限公司的商标。
本文档提及的其他所有商标或注册商标，由各自的所有人拥有。

注意
您购买的产品、服务或特性等应受华为公司商业合同和条款的约束，本文档中描述的全部或部分产品、服务或特性可能不在您的购买或使用范围之内。除非合同另有约定，华为公司对本文档内容不做任何明示或默示的声明或保证。
由于产品版本升级或其他原因，本文档内容会不定期进行更新。除非另有约定，本文档仅作为使用指导，本文档中的所有陈述、信息和建议不构成任何明示或暗示的担保。














华为技术有限公司
地址：	深圳市龙岗区坂田华为总部办公楼     邮编：518129
网址：	http://www.huawei.com

客户服务邮箱：	support@huawei.com

客户服务电话：	0755-28560000  4008302118
客户服务传真：	0755-28560111
	
	
修订记录
日期	修订版本	描述	作者
2009-12-8	1.00	初稿完成	陈悦
2011-9-24	2.00	增加二层互通的使用限制，新增OPGD单板信息	江鹏
			
			
			
			
			
			
			
			
			
资料问题反馈渠道

	您在阅读本资料过程中，发现有任何问题（如错误、表述不清，重要内容遗漏等），或对资料改进有建议等，请及时向邮箱public ZLHOTLINE@notemail.huawei.com反馈；（该邮箱是网络MKTG为收集资料问题专门设立的邮箱，由专人处理，并保证在2个工作日内给出答复；）
	为使您的意见得到更快速的响应，请您在反馈意见时注意以下几点：
1.	请保证您的资料是从3MS而非其他渠道获取的；
2.	请给出资料的准确名称和作者，以便能快速找到资料及责任人；
3.	请给出有问题的地方在本资料中的位置；（如标识出页码，或拷贝有问题的段落等）

目  录
1 执行摘要/Executive Summary	6
2 简介/Introduction	7
3 解决方案/Solution	9
3.1 二层互通应用场景	9
3.2 MA5600T二层互通解决方案	12
4 推广/Experience	18
5 结论/Conclution	19
6 缩略语表/Acronyms and Abbreviations	20

 
1 执行摘要/Executive Summary
本文描述MA5600T V8R9版本实现的基于VLAN的二层互通特性，本特性主要满足企业接入及OLT下的语音用户互通的需求
 
2 简介/Introduction
通常情况下，企业各个分部分布在不同的地方，通过不同的设备进行接入，其二层互通是通过设备间L2专线来实现的：
 
图2-1 设备间的L2专线
如上图，是通过QinQ VLAN实现的简单的L2 VPN：
	内层VLAN代表企业不同的部门，如图中的VLAN1和VLAN2分别代表财务部和销售部；
	外层VLAN代表一个企业出口的公共VLAN；如图中的VLAN3。在接入设备上（MSAN/DSLAM/OLT），把VLAN1和VLAN2的报文都加上一个外层VLAN3；
	通过外层VLAN实现不同分支机构在公共二层网络上的互通
随着FTTX网络的部署，OLT的容量越来越大，网络位置越来越高，一个企业不同的分支机构位于同一个OLT下面的情况也越来也多，这就要求同一个OLT下的各个分支机构可以实现二层网络上的互通。
但是，传统的接入网，由于安全原因，都会把一个VLAN下的各个用户端口进行隔离。即上图中，如果总部和分部在同一台OLT下面，总部的销售部的VLAN2和分部的销售部的VLAN2下的用户是不能互通的。
当然，传统OLT也可以把系统的LAN SWITCH芯片的二层互通功能放开，但是这种放开往往是基于整个系统的，即所有VLAN下的用户都放开了二层互通功能，这样产生的问题一是用户数据安全得不到保证，二是导致大量的带宽浪费。
因此，基于这种背景，急需OLT支持基于VLAN支持二层互通功能。




 
3 解决方案/Solution
3.1 二层互通应用场景
3.1.1 采用QinQ方案实现不同OLT间的企业分部互通
企业带C-TAG接入
 
图3-1 企业带C-TAG接入
如图，企业用户的报文中已经携带了一个VLAN，其不同的部门可能采用不同的VLAN。
在ONT上，为报文增加一层SVLAN，使得报文到达OLT时，已经携带两层VLAN：CVLAN和SVLAN。OLT上可设置对这种报文进行直接转发。
上层设备可对SVLAN内的用户进行转发，使得报文到达另一端的OLT设备，OLT对报文进行下行转发。如果两个OLT之间是跨三层的组网，则建议上层设备之间开L2VPN。在ONT上剥离SVLAN后，把内层CVLAN转发给企业用户终端设备。这样就实现了企业用户的二层专线业务。
当然，这时ONT也可以不添加SVLAN，由OLT来添加后再转发。

企业untagged接入
 
图3-2 企业untagged接入
如图，企业用户设备上行的报文不带任何VLAN，为untagged报文。
在ONT上，需要给报文打一层CVLAN；在OLT上再打上SVLAN。报文转发到另一端OLT后，OLT剥离SVLAN再转发给ONT，ONT再把CVLAN剥离后转发给用户设备。
当然，ONT也可直接添加两层VLAN，OLT只做转发。

3.1.2 利用二层互通特性实现同一个OLT内部的企业分部互通
企业带C-TAG接入
 
图3-3 同一个OLT下的企业分部TAG报文互通
如图，企业的不同分部位于同一个OLT下面，各分部之间需要在OLT上进行二层互通。
由于OLT从ONT收到的报文已经携带SVLAN和CVLAN两层报文，OLT上需要启动SVLAN内的二层互通报文。这样，各分部之间的数据流无需经过OLT的上行接口流入到上层网络中，直接在OLT上进行互通。

企业untagged接入
 
图3-4 同一个OLT下的企业分部untaggged报文互通
如图，OLT收到的报文只携带CVLAN。
如果报文是要上行的话，则OLT会把在报文上添加SVLAN后再上行转发；如果报文是要发送到另外一个分部，则报文进入OLT会先打上SVLAN，内部进行转发后，再剥离SVLAN发送到对端的ONT。

3.2 MA5600T二层互通解决方案
3.2.1 OLT下语音用户的互通
对于同一个OLT上的两个语音用户，其IP地址一般在同一个网段，由于二层隔离了，这两个用户就不能在这个网段直接交互，需要将报文发送到上面的网关设备，再由网关设备做三层转发来实现互通，这就需要上面的网关设备实现ARP PROXY，增加了对网关设备的要求。而且，这时语音的媒体流需要上行到网关设备，也浪费上行口的带宽。
 
图3-5 OLT下语音用户在SR上进行互通
如上图，媒体流需要上行到网关上进行互通。但是有一些较老的路由器，不支持从一个接口收到的报文，再转发回同一个接口。这时必须由下面的设备进行互通。即由LSW或OLT启用三层功能，做ARP proxy，在VLAN接口上进行三层互通。如果OLT直接连SR，则只能由OLT做ARP proxy。
实际上，在OLT上做ARP PROXY会浪费IP地址，而且导致网络配置复杂（相当于OLT上启用了三层功能），组网不清晰（二层网络和三层网络混杂在一起）
因此，这种场景下也需要OLT实现VLAN的二层互通功能。
 
图3-6 OLT下语音用户的互通



3.2.2 多个企业分部的互通
 
图3-7 多个企业分部放在同一个OLT下的二层互通

企业的多个分部都挂在同一个MA5600T上，各个分部挂在同一块单板下，也可能挂在不同的单板上；也可能部分分部使用P2MP接入，部分分部使用P2P接入。
上述这几种场景，MA5600T都可以支持各分部之间的二层互通，即MA5600T支持：
	同一个PON口下不同ONT之间的二层互通
	板内的二层互通，包括PON板内不同端口的二层互通，P2P板内不同端口的二层互通
	板间的二层互通，包括PON板和PON板之间的端口二层互通，P2P板和P2P板之间的端口二层互通，PON板和P2P板之间的端口二层互通
这个应用的约束是：
	同一个ONU下禁止二层互通（从此ONU收到的报文不能再二层转发到此ONU）；
	同一个P2P端口下禁止二层互通（从此端口收到的报文不能再二层转发到此端口）；
同一个ONU或P2P下，要实现二层互通，只能要求相应的ONU或P2P终端来支持，或者客户内部的终端设备支持。

3.2.3 混合应用
 
图3-8 VPN用户和普通用户混合应用
应用场景：ONU放在楼道，下挂的用户既有企业用户，也有个人用户，不过，这些不同的用户是使用不同的VLAN的。这样就需要OLT支持基于VLAN的二层互通。
MA5600T可以支持基于VLAN的二层互通，同一个ONU下的用户可以基于VLAN进行区分，部分开通二层互通功能，部分用户关闭二层互通功能。
如上图，VPN用户之间可以开通二层互通功能，而个人用户则关闭二层互通功能。
MA5600T支持的功能：
	基于VLAN配置是否开通二层互通功能。
	SVLAN+CVLAN的情况下，基于SVLAN配置是否开通二层互通功能；只有一层VLAN的情况下，基于此VLAN配置是否开通二层互通功能。
	支持开通二层互通功能的VLAN类型为：Smart VLAN，其他类型的VLAN，如super VLAN、mux VLAN、standard VLAN不支持开通二层互通功能
	系统内所有的Smart VLAN都可以支持开通二层互通功能
3.3 二层互通的可获得性
3.3.1 支持二层互通的软硬件组合
主控板：SCUN
业务版：GPBC / GPBD / EPBC / EPBD / OPFA/OPGD/SPUA
软件：V8R7以上版本，且这个特性需要license的支持。

注：SCUL由于LSW的原因，不支持基于VLAN启用二层互通。

3.3.2 二层互通特性和其他特性的关系
二层互通和S+C转发模式互斥：
如果SVLAN配置了S+C转发模式，则不可以启动此VLAN的二层互通；反过来，SVLAN配置了二层互通，则不可以在配置S+C转发模式。
原因：二层互通必须基于VLAN＋MAC的转发模式，而S+C转发模式关闭了MAC学习功能。

二层互通和ARP Proxy功能互斥：
如果SVLAN创建了三层接口，并启动了ARP Proxy功能，则不可以启动此VLAN的二层互通；反过来，SVLAN配置了二层互通，则不可以在创建三层接口后再启动ARP Proxy功能。
这个比较好理解，ARP Proxy的功能就是让同一个VLAN下隔离的各个端口进行互通，二层互通也是完成同一个功能。这两个只能二选一。

 
4 推广/Experience
采用基于VLAN的二层互通技术，既可以满足企业应用的需求，也可以满足语音组网应用需求，同时又兼顾了其他VLAN的的用户的安全需求。通过基于VLAN开通二层互通功能，无需在OLT上启用ARP proxy功能来实现VLAN内的用户互通，节省IP地址。

 
5 结论/Conclution
如果OLT不支持二层互通功能，则其他方案为
1、	在OLT上启用ARP Praoxy功能，缺点在于：
	会浪费IP地址
	配置复杂，管理麻烦
2、	上层设备上进行二层互通，缺点在于：浪费OLT的上层接口带宽
因此，基于VLAN的二层互通功能可以有效解决其他方案的缺点，使得用户的网络简单，易于维护。

 
6 缩略语表/Acronyms and Abbreviations
表6-1 缩略语清单
英文缩写	英文全称	中文全称
SCUL	Super Control Unit Board VerL	SCU主控板L版本，面板上不出端口
SCUN	Super Control Unit Board VerN	SCU主控板N版本，面板有4个GE端口
OLT	Optical Line Terminal	光线路终端
MDU	Multiple Dwelling Unit	多住宅单元
MTU	Multiple Tenant Unit	多租用单元
ONT	Optical Network Terminal	光网络终端
ONU	Optical Network Unit	光网络单元
LSW	LanSwitch	交换芯片
VLAN	Virtual Local Area Network	虚拟局域网
		
		
		
		
		
		
		
		

